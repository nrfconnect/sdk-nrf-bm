#
# Copyright (c) 2025 Nordic Semiconductor ASA
#
# SPDX-License-Identifier: LicenseRef-Nordic-5-Clause
#

menuconfig BM_ZMS
	bool "Bare Metal Zephyr Memory Storage [EXPERIMENTAL]"
	select CRC
	select RING_BUFFER
	select BM_STORAGE
	select EXPERIMENTAL
	help
	  Bare Metal Zephyr Memory Storage library.

if BM_ZMS

config BM_ZMS_LOOKUP_CACHE
	bool "BM_ZMS lookup cache"
	help
	  Enable BM_ZMS cache to reduce the BM_ZMS data lookup time.
	  Each cache entry holds an address of the most recent allocation
	  table entry (ATE) for all BM_ZMS IDs that fall into that cache position.

config BM_ZMS_LOOKUP_CACHE_SIZE
	int "BM_ZMS lookup cache size"
	range 1 65536
	default 128
	depends on BM_ZMS_LOOKUP_CACHE
	help
	  Number of entries in the BM_ZMS lookup cache.
	  Every additional entry in cache will use 8 bytes of RAM.

config BM_ZMS_DATA_CRC
	bool "BM_ZMS data CRC"

config BM_ZMS_CUSTOMIZE_BLOCK_SIZE
	bool "Customize the size of the buffer used internally for reads and writes"
	help
	  BM_ZMS uses an internal buffer to read/write and compare stored data.
	  Increasing the size of this buffer should be done carefully in order to not
	  overflow the stack.
	  Increasing it makes BM_ZMS able to work with storage devices
	  that have a larger `write-block-size` (which decreases the performance of BM_ZMS).

config BM_ZMS_CUSTOM_BLOCK_SIZE
	int "BM_ZMS internal buffer size"
	depends on BM_ZMS_CUSTOMIZE_BLOCK_SIZE
	default 32
	help
	  Changes the internal buffer size of BM_ZMS.

config BM_ZMS_LOOKUP_CACHE_FOR_SETTINGS
	bool "BM_ZMS Storage lookup cache optimized for settings"
	depends on BM_ZMS_LOOKUP_CACHE && SETTINGS_BM_ZMS
	help
	  Enable usage of lookup cache based on hashes to get, the best BM_ZMS performance,
	  provided that the BM_ZMS is used only for the purpose of providing the settings
	  backend. This option should NOT be enabled if the BM_ZMS is also written to
	  directly, outside the settings layer.

config BM_ZMS_MAX_USERS
	int "BM_ZMS maximum users"
	default 8
	help
	  Defines the maximum number of event handlers that can be registred by the user.

config BM_ZMS_OP_QUEUE_SIZE
	int "BM_ZMS operations queue size"
	default 16
	help
	  defines the maximum number of operations that can be queued in BM_ZMS

module=BM_ZMS
module-dep=LOG
module-str=BM_ZMS
source "subsys/logging/Kconfig.template.log_config"

endif # BM_ZMS
